<template>
  <div class="detail-page">
    <!-- å¯¼èˆªæ  -->
    <div class="nav-bar">
      <div class="nav-container">
        <div class="nav-left">
          <el-button type="text" @click="$router.push('/teaching-process')">
            <el-icon><ArrowLeft /></el-icon>
            è¿”å›æ•™å­¦è¿‡ç¨‹
          </el-button>
        </div>
        <div class="nav-center">
          <h2>ç¬¬äºŒæ­¥ï¼šé‡‘èäº§å“ä¸æœåŠ¡</h2>
        </div>
        <div class="nav-right">
          <span class="progress-text">2 / 6</span>
        </div>
      </div>
    </div>

    <!-- ä¸»è¦å†…å®¹ -->
    <div class="content-wrapper">
      <div class="content-container">
        <!-- ç« èŠ‚å¯¼èˆª -->
        <div class="chapter-nav">
          <el-card class="chapter-card">
            <div class="chapter-header">
              <h3>ğŸ’³ ç¬¬äºŒæ­¥ï¼šé‡‘èäº§å“ä¸æœåŠ¡</h3>
              <el-tag type="info">ç¬¬2æ­¥ / å…±6æ­¥</el-tag>
            </div>
            <div class="chapter-progress">
              <el-progress
                :percentage="33.33"
                :stroke-width="8"
                color="#67C23A"
              />
              <span class="progress-text">33.3% å®Œæˆ</span>
            </div>
          </el-card>
        </div>

        <!-- è¯¦ç»†å†…å®¹ -->
        <div class="detail-content">
          <!-- 2.1 å­˜æ¬¾ä¸è´·æ¬¾ä¸šåŠ¡ -->
          <el-card class="content-card" id="section-2-1">
            <template #header>
              <div class="card-header">
                <span class="section-title">2.1 å­˜æ¬¾ä¸è´·æ¬¾ä¸šåŠ¡</span>
                <el-tag size="small" type="success">å·²å®Œæˆ</el-tag>
              </div>
            </template>
            <div class="section-content">
              <div class="learning-objectives">
                <h4>ğŸ¯ å­¦ä¹ ç›®æ ‡</h4>
                <ul>
                  <li>æŒæ¡å„ç±»å­˜æ¬¾äº§å“çš„ç‰¹ç‚¹å’Œé€‚ç”¨åœºæ™¯</li>
                  <li>äº†è§£è´·æ¬¾ä¸šåŠ¡çš„åŸºæœ¬æµç¨‹å’Œå®¡æ‰¹è¦ç´ </li>
                  <li>ç†è§£å­˜è´·æ¬¾åˆ©ç‡çš„è®¡ç®—æ–¹æ³•</li>
                </ul>
              </div>

              <div class="key-concepts">
                <h4>ğŸ“– æ ¸å¿ƒäº§å“ç±»å‹</h4>
                <div class="concept-grid">
                  <div class="concept-item">
                    <h5>ğŸ’° å‚¨è“„å­˜æ¬¾</h5>
                    <p>
                      ä¸ªäººå‚¨è“„å­˜æ¬¾åŒ…æ‹¬æ´»æœŸå­˜æ¬¾ã€å®šæœŸå­˜æ¬¾ã€é›¶å­˜æ•´å–ç­‰å¤šç§å½¢å¼ï¼Œæ»¡è¶³ä¸åŒå®¢æˆ·çš„èµ„é‡‘ç®¡ç†éœ€æ±‚ã€‚
                    </p>
                  </div>
                  <div class="concept-item">
                    <h5>ğŸ¦ ä¼ä¸šå­˜æ¬¾</h5>
                    <p>
                      ä¼ä¸šå­˜æ¬¾åŒ…æ‹¬å¯¹å…¬æ´»æœŸè´¦æˆ·ã€å®šæœŸå­˜æ¬¾ã€é€šçŸ¥å­˜æ¬¾ç­‰ï¼Œç”¨äºä¼ä¸šæ—¥å¸¸ç»è¥å’Œèµ„é‡‘ç®¡ç†ã€‚
                    </p>
                  </div>
                  <div class="concept-item">
                    <h5>ğŸ“Š è´·æ¬¾äº§å“</h5>
                    <p>
                      åŒ…æ‹¬ä¸ªäººæ¶ˆè´¹è´·æ¬¾ã€ä½æˆ¿è´·æ¬¾ã€ä¼ä¸šç»è¥è´·æ¬¾ç­‰ï¼Œæ ¹æ®å®¢æˆ·éœ€æ±‚æä¾›ä¸åŒæœŸé™å’Œé¢åº¦çš„èèµ„æœåŠ¡ã€‚
                    </p>
                  </div>
                </div>
              </div>

              <div class="practice-section">
                <h4>ğŸ’¡ æ¡ˆä¾‹åˆ†æ</h4>
                <el-card class="quiz-card">
                  <p>
                    <strong>åœºæ™¯ï¼š</strong
                    >å¼ å…ˆç”Ÿæœ‰10ä¸‡å…ƒé—²ç½®èµ„é‡‘ï¼Œè®¡åˆ’1å¹´åä½¿ç”¨ã€‚ä»¥ä¸‹å“ªç§å­˜æ¬¾æ–¹å¼æœ€é€‚åˆï¼Ÿ
                  </p>
                  <el-radio-group v-model="quiz1" class="quiz-options">
                    <el-radio label="A">æ´»æœŸå­˜æ¬¾</el-radio>
                    <el-radio label="B">1å¹´æœŸå®šæœŸå­˜æ¬¾</el-radio>
                    <el-radio label="C">3ä¸ªæœˆå®šæœŸå­˜æ¬¾</el-radio>
                    <el-radio label="D">é€šçŸ¥å­˜æ¬¾</el-radio>
                  </el-radio-group>
                  <div class="quiz-result" v-if="quiz1">
                    <el-alert
                      :type="quiz1 === 'B' ? 'success' : 'error'"
                      :title="
                        quiz1 === 'B'
                          ? 'å›ç­”æ­£ç¡®ï¼1å¹´æœŸå®šæœŸå­˜æ¬¾åˆ©ç‡æœ€é«˜ä¸”ç¬¦åˆä½¿ç”¨æ—¶é—´'
                          : 'å›ç­”é”™è¯¯ï¼Œæ­£ç¡®ç­”æ¡ˆæ˜¯Bé€‰é¡¹'
                      "
                      show-icon
                    />
                  </div>
                </el-card>
              </div>
            </div>
          </el-card>

          <!-- 2.2 æ”¯ä»˜ç»“ç®—æœåŠ¡ -->
          <el-card class="content-card" id="section-2-2">
            <template #header>
              <div class="card-header">
                <span class="section-title">2.2 æ”¯ä»˜ç»“ç®—æœåŠ¡</span>
                <el-tag size="small" type="warning">è¿›è¡Œä¸­</el-tag>
              </div>
            </template>
            <div class="section-content">
              <div class="learning-objectives">
                <h4>ğŸ¯ å­¦ä¹ ç›®æ ‡</h4>
                <ul>
                  <li>æŒæ¡å„ç±»æ”¯ä»˜ç»“ç®—å·¥å…·çš„ä½¿ç”¨æ–¹æ³•</li>
                  <li>äº†è§£è·¨è¡Œè½¬è´¦å’ŒåŒè¡Œè½¬è´¦çš„åŒºåˆ«</li>
                  <li>ç†è§£æ”¯ä»˜æ¸…ç®—ç³»ç»Ÿçš„è¿ä½œæœºåˆ¶</li>
                </ul>
              </div>

              <div class="service-types">
                <h4>ğŸ’³ ä¸»è¦æ”¯ä»˜æ–¹å¼</h4>
                <div class="service-grid">
                  <div class="service-card">
                    <div class="service-icon">ğŸ’¸</div>
                    <h5>è½¬è´¦æ±‡æ¬¾</h5>
                    <p>æ”¯æŒåŒè¡Œè½¬è´¦ã€è·¨è¡Œè½¬è´¦ã€å®æ—¶åˆ°è´¦ã€æ™®é€šåˆ°è´¦ç­‰å¤šç§æ–¹å¼</p>
                    <div class="service-features">
                      <span class="feature-tag">å®æ—¶åˆ°è´¦</span>
                      <span class="feature-tag">æ‰‹ç»­è´¹ä½</span>
                    </div>
                  </div>
                  <div class="service-card">
                    <div class="service-icon">ğŸ“±</div>
                    <h5>ç§»åŠ¨æ”¯ä»˜</h5>
                    <p>é€šè¿‡æ‰‹æœºé“¶è¡Œã€å¾®ä¿¡ã€æ”¯ä»˜å®ç­‰æ¸ é“å®Œæˆä¾¿æ·æ”¯ä»˜</p>
                    <div class="service-features">
                      <span class="feature-tag">ä¾¿æ·å¿«é€Ÿ</span>
                      <span class="feature-tag">å®‰å…¨å¯é </span>
                    </div>
                  </div>
                  <div class="service-card">
                    <div class="service-icon">ğŸ¢</div>
                    <h5>ä»£æ”¶ä»£ä»˜</h5>
                    <p>ä¸ºä¼ä¸šæä¾›æ‰¹é‡ä»£å‘å·¥èµ„ã€ä»£æ”¶æ¬¾é¡¹ç­‰æœåŠ¡</p>
                    <div class="service-features">
                      <span class="feature-tag">æ‰¹é‡å¤„ç†</span>
                      <span class="feature-tag">é«˜æ•ˆä¾¿æ·</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </el-card>

          <!-- 2.3 æŠ•èµ„ç†è´¢äº§å“ -->
          <el-card class="content-card" id="section-2-3">
            <template #header>
              <div class="card-header">
                <span class="section-title">2.3 æŠ•èµ„ç†è´¢äº§å“</span>
                <el-tag size="small" type="info">æœªå¼€å§‹</el-tag>
              </div>
            </template>
            <div class="section-content">
              <div class="learning-objectives">
                <h4>ğŸ¯ å­¦ä¹ ç›®æ ‡</h4>
                <ul>
                  <li>äº†è§£å„ç±»ç†è´¢äº§å“çš„é£é™©æ”¶ç›Šç‰¹å¾</li>
                  <li>æŒæ¡åŸºé‡‘ã€ä¿é™©ã€ä¿¡æ‰˜äº§å“çš„åŸºæœ¬çŸ¥è¯†</li>
                  <li>å­¦ä¼šæ ¹æ®å®¢æˆ·éœ€æ±‚æ¨èåˆé€‚çš„ç†è´¢äº§å“</li>
                </ul>
              </div>

              <div class="product-comparison">
                <h4>ğŸ“Š ç†è´¢äº§å“å¯¹æ¯”</h4>
                <div class="comparison-table">
                  <div class="comparison-row header">
                    <div class="col">äº§å“ç±»å‹</div>
                    <div class="col">é£é™©ç­‰çº§</div>
                    <div class="col">é¢„æœŸæ”¶ç›Š</div>
                    <div class="col">æµåŠ¨æ€§</div>
                  </div>
                  <div class="comparison-row">
                    <div class="col">è´§å¸åŸºé‡‘</div>
                    <div class="col">
                      <el-tag size="small" type="success">ä½é£é™©</el-tag>
                    </div>
                    <div class="col">2-3%</div>
                    <div class="col">T+1</div>
                  </div>
                  <div class="comparison-row">
                    <div class="col">å€ºåˆ¸åŸºé‡‘</div>
                    <div class="col">
                      <el-tag size="small" type="warning">ä¸­ä½é£é™©</el-tag>
                    </div>
                    <div class="col">4-6%</div>
                    <div class="col">T+2</div>
                  </div>
                  <div class="comparison-row">
                    <div class="col">è‚¡ç¥¨åŸºé‡‘</div>
                    <div class="col">
                      <el-tag size="small" type="danger">é«˜é£é™©</el-tag>
                    </div>
                    <div class="col">8-15%</div>
                    <div class="col">T+2</div>
                  </div>
                </div>
              </div>
            </div>
          </el-card>

          <!-- æ›´å¤šç« èŠ‚é¢„è§ˆ -->
          <el-card class="preview-card">
            <div class="preview-content">
              <h4>ğŸ“‹ åç»­ç« èŠ‚é¢„è§ˆ</h4>
              <div class="preview-items">
                <div class="preview-item">
                  <span class="preview-number">2.4</span>
                  <span class="preview-title">å¤–æ±‡ä¸å›½é™…ä¸šåŠ¡</span>
                  <el-tag size="mini" type="info">æœªå¼€å§‹</el-tag>
                </div>
                <div class="preview-item">
                  <span class="preview-number">2.5</span>
                  <span class="preview-title">ä¿¡ç”¨å¡ä¸šåŠ¡</span>
                  <el-tag size="mini" type="info">æœªå¼€å§‹</el-tag>
                </div>
                <div class="preview-item">
                  <span class="preview-number">2.6</span>
                  <span class="preview-title">æ¶ˆè´¹é‡‘èäº§å“</span>
                  <el-tag size="mini" type="info">æœªå¼€å§‹</el-tag>
                </div>
                <div class="preview-item">
                  <span class="preview-number">2.7</span>
                  <span class="preview-title">ä¼ä¸šé‡‘èæœåŠ¡</span>
                  <el-tag size="mini" type="info">æœªå¼€å§‹</el-tag>
                </div>
                <div class="preview-item">
                  <span class="preview-number">2.8</span>
                  <span class="preview-title">å®æ“æ¼”ç»ƒ</span>
                  <el-tag size="mini" type="info">æœªå¼€å§‹</el-tag>
                </div>
              </div>
            </div>
          </el-card>
        </div>

        <!-- åº•éƒ¨å¯¼èˆª -->
        <div class="bottom-nav">
          <div class="nav-buttons">
            <el-button size="large" @click="prevChapter">
              <el-icon><ArrowLeft /></el-icon>
              ä¸Šä¸€ç« ï¼šé‡‘èåŸºç¡€çŸ¥è¯†
            </el-button>
            <div class="twobtnjiehe">
              <el-button
                type="success"
                size="large"
                class="wanchengbtn"
                @click="completeStudy"
              >
                âœ“ å®Œæˆæœ¬ç« å­¦ä¹ 
              </el-button>
              <el-button size="large" type="primary" @click="nextChapter">
                ä¸‹ä¸€ç« ï¼šé£é™©ç®¡ç†ä¸æ§åˆ¶
                <el-icon><ArrowRight /></el-icon>
              </el-button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import { ref, onMounted } from "vue";
import { useRouter } from "vue-router";
import { ElMessage, ElMessageBox } from "element-plus";
import { ArrowLeft, ArrowRight } from "@element-plus/icons-vue";

export default {
  name: "TeachingProcessTwo",
  components: {
    ArrowLeft,
    ArrowRight,
  },
  setup() {
    const router = useRouter();
    const quiz1 = ref("");
    const isCompleted = ref(false);

    // æ£€æŸ¥æ˜¯å¦å·²ç»å®Œæˆè¿‡
    onMounted(() => {
      const progress = JSON.parse(
        localStorage.getItem("teachingProgress") || "{}"
      );
      if (progress.stepTasks && progress.stepTasks["step1"]?.completed) {
        isCompleted.value = true;
      }
    });

    // å®Œæˆæœ¬ç« å­¦ä¹ 
    const completeStudy = () => {
      ElMessageBox.confirm("ç¡®è®¤å·²å®Œæˆæœ¬ç« æ‰€æœ‰å†…å®¹çš„å­¦ä¹ å—ï¼Ÿ", "å®Œæˆå­¦ä¹ ", {
        confirmButtonText: "ç¡®è®¤å®Œæˆ",
        cancelButtonText: "ç»§ç»­å­¦ä¹ ",
        type: "success",
      })
        .then(() => {
          // ä» localStorage è·å–å½“å‰è¿›åº¦
          let progress = JSON.parse(
            localStorage.getItem("teachingProgress") || "{}"
          );

          // æ›´æ–°è¿›åº¦æ•°æ®ï¼ˆåœ¨ç¬¬ä¸€æ­¥çš„åŸºç¡€ä¸Šå åŠ ï¼‰
          progress.completedSteps = Math.max(progress.completedSteps || 0, 2); // å®Œæˆç¬¬äºŒæ­¥
          progress.currentStep = Math.max(progress.currentStep || 0, 2); // å½“å‰åœ¨ç¬¬ä¸‰æ­¥

          // æ ‡è®°ç¬¬äºŒæ­¥çš„æ‰€æœ‰ä»»åŠ¡ä¸ºå·²å®Œæˆ
          if (!progress.stepTasks) {
            progress.stepTasks = {};
          }
          progress.stepTasks["step1"] = {
            completed: true,
            completedCount: 8, // ç¬¬äºŒæ­¥æœ‰8ä¸ªä»»åŠ¡
            totalCount: 8,
          };

          // ä¿å­˜åˆ° localStorage
          localStorage.setItem("teachingProgress", JSON.stringify(progress));

          isCompleted.value = true;

          ElMessage.success({
            message: "æ­å–œå®Œæˆç¬¬äºŒç« å­¦ä¹ ï¼è¿›åº¦å·²ä¿å­˜",
            duration: 2000,
          });

          // 2ç§’åè¿”å›æ•™å­¦è¿‡ç¨‹é¡µé¢
          setTimeout(() => {
            router.push("/teaching-process");
          }, 2000);
        })
        .catch(() => {
          ElMessage.info("ç»§ç»­å­¦ä¹ ä¸­...");
        });
    };

    const prevChapter = () => {
      router.push("/teaching-process/one");
    };

    const nextChapter = () => {
      router.push("/teaching-process/three");
    };

    return {
      quiz1,
      isCompleted,
      completeStudy,
      prevChapter,
      nextChapter,
    };
  },
};
</script>

<style scoped>
.detail-page {
  width: 100%;
  min-height: 100vh;
  background: #f0f2f5;
}

.nav-bar {
  background: #fff;
  border-bottom: 1px solid #e4e7ed;
  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
  top: 0;
  z-index: 1000;
  width: 100%;
}

.nav-container {
  width: 100%;
  padding: 0 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  height: 60px;
}

.nav-center h2 {
  margin: 0;
  color: #303133;
  font-size: 18px;
  font-weight: 600;
}

.progress-text {
  color: #909399;
  font-size: 14px;
}

.content-wrapper {
  width: 100%;
  padding: 20px;
}

.content-container {
  width: 100%;
  padding: 0;
}

.chapter-nav {
  margin-bottom: 20px;
}

.chapter-card {
  border-radius: 8px;
}

.chapter-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.chapter-header h3 {
  margin: 0;
  color: #303133;
}

.chapter-progress {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-top: 10px;
}

.chapter-progress .progress-text {
  font-size: 12px;
  color: #909399;
}

.detail-content {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.content-card {
  border-radius: 8px;
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.section-title {
  font-weight: 600;
  color: #303133;
}

.section-content {
  padding: 10px 0;
}

.learning-objectives {
  margin-bottom: 15px;
}

.key-concepts {
  margin-bottom: 15px;
}

.learning-objectives h4,
.key-concepts h4,
.practice-section h4,
.service-types h4,
.product-comparison h4 {
  color: #303133;
  margin-bottom: 15px;
  font-size: 16px;
}

.learning-objectives ul {
  padding-left: 20px;
}

.learning-objectives li {
  margin-bottom: 8px;
  color: #606266;
}

.concept-grid,
.service-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 15px;
  margin-top: 15px;
}

.concept-item,
.service-card {
  padding: 15px;
  border: 1px solid #e4e7ed;
  border-radius: 6px;
  background: #fafafa;
  transition: all 0.3s;
}

.concept-item:hover,
.service-card:hover {
  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
  transform: translateY(-2px);
}

.concept-item h5,
.service-card h5 {
  margin: 0 0 8px 0;
  color: #303133;
  font-size: 14px;
}

.concept-item p,
.service-card p {
  margin: 0;
  color: #606266;
  font-size: 13px;
  line-height: 1.5;
}

.service-icon {
  font-size: 32px;
  margin-bottom: 10px;
}

.service-features {
  display: flex;
  gap: 8px;
  margin-top: 10px;
}

.feature-tag {
  padding: 2px 8px;
  background: #ecf5ff;
  color: #409eff;
  border-radius: 4px;
  font-size: 12px;
}

.quiz-card {
  margin-top: 15px;
}

.quiz-options {
  margin-top: 15px;
}

.quiz-options .el-radio {
  display: block;
  margin-bottom: 10px;
}

.comparison-table {
  margin-top: 15px;
  border: 1px solid #e4e7ed;
  border-radius: 6px;
  overflow: hidden;
}

.comparison-row {
  display: grid;
  grid-template-columns: 2fr 1.5fr 1.5fr 1fr;
  border-bottom: 1px solid #e4e7ed;
}

.comparison-row:last-child {
  border-bottom: none;
}

.comparison-row.header {
  background: #f5f7fa;
  font-weight: 600;
}

.comparison-row .col {
  padding: 12px 15px;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  border-right: 1px solid #e4e7ed;
}

.comparison-row .col:last-child {
  border-right: none;
}

.preview-card {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
}

.preview-content h4 {
  margin: 0 0 15px 0;
  color: white;
}

.preview-items {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.preview-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 6px;
  backdrop-filter: blur(10px);
}

.preview-number {
  background: rgba(255, 255, 255, 0.2);
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 600;
  min-width: 35px;
  text-align: center;
}

.preview-title {
  flex: 1;
  font-size: 14px;
}

.bottom-nav {
  margin-top: 30px;
  padding: 20px 0;
  border-top: 1px solid #e4e7ed;
}

.nav-buttons {
  display: flex;
  justify-content: space-between;
  gap: 15px;
  flex-wrap: wrap;
}

@media (max-width: 768px) {
  .nav-container {
    padding: 0 15px;
  }

  .content-container {
    padding: 0 15px;
  }

  .concept-grid,
  .service-grid {
    grid-template-columns: 1fr;
  }

  .nav-center h2 {
    font-size: 16px;
  }

  .comparison-row {
    grid-template-columns: 1fr;
  }

  .comparison-row .col {
    border-right: none;
    border-bottom: 1px solid #e4e7ed;
  }

  .nav-buttons {
    flex-direction: column;
  }
}
</style>
