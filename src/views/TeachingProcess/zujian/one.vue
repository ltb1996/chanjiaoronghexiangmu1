<template>
  <div class="detail-page">
    <!-- å¯¼èˆªæ  -->
    <div class="nav-bar">
      <div class="nav-container">
        <div class="nav-left">
          <el-button type="text" @click="$router.push('/teaching-process')">
            <el-icon><ArrowLeft /></el-icon>
            è¿”å›æ•™å­¦è¿‡ç¨‹
          </el-button>
        </div>
        <div class="nav-center">
          <h2>ç¬¬ä¸€æ­¥ï¼šé‡‘èåŸºç¡€çŸ¥è¯†å­¦ä¹ </h2>
        </div>
        <div class="nav-right">
          <span class="progress-text">1 / 6</span>
        </div>
      </div>
    </div>

    <!-- ä¸»è¦å†…å®¹ -->
    <div class="content-wrapper">
      <div class="content-container">
        <!-- ç« èŠ‚å¯¼èˆª -->
        <div class="chapter-nav">
          <el-card class="chapter-card">
            <div class="chapter-header">
              <h3>ğŸ“š ç¬¬ä¸€æ­¥ï¼šé‡‘èåŸºç¡€çŸ¥è¯†å­¦ä¹ </h3>
              <el-tag type="info">ç¬¬1æ­¥ / å…±6æ­¥</el-tag>
            </div>
            <div class="chapter-progress">
              <el-progress
                :percentage="16.67"
                :stroke-width="8"
                color="#409EFF"
              />
              <span class="progress-text">16.7% å®Œæˆ</span>
            </div>
          </el-card>
        </div>

        <!-- è¯¦ç»†å†…å®¹ -->
        <div class="detail-content">
          <!-- 1.1 é‡‘èå­¦åŸºç¡€ -->
          <el-card class="content-card" id="section-1-1">
            <template #header>
              <div class="card-header">
                <span class="section-title">1.1 é‡‘èå­¦åŸºç¡€</span>
                <el-tag size="small" type="success">å·²å®Œæˆ</el-tag>
              </div>
            </template>
            <div class="section-content">
              <div class="learning-objectives">
                <h4>ğŸ¯ å­¦ä¹ ç›®æ ‡</h4>
                <ul>
                  <li>ç†è§£è´§å¸çš„æœ¬è´¨å’ŒèŒèƒ½</li>
                  <li>æŒæ¡åˆ©ç‡ã€é€šè´§è†¨èƒ€ã€æ±‡ç‡ç­‰åŸºæœ¬æ¦‚å¿µ</li>
                  <li>äº†è§£é‡‘èå¸‚åœºçš„è¿è¡Œæœºåˆ¶</li>
                </ul>
              </div>

              <div class="key-concepts">
                <h4>ğŸ“– æ ¸å¿ƒæ¦‚å¿µ</h4>
                <div class="concept-grid">
                  <div class="concept-item">
                    <h5>è´§å¸çš„èŒèƒ½</h5>
                    <p>
                      è´§å¸å…·æœ‰ä»·å€¼å°ºåº¦ã€æµé€šæ‰‹æ®µã€æ”¯ä»˜æ‰‹æ®µã€è´®è—æ‰‹æ®µå’Œä¸–ç•Œè´§å¸äº”ç§èŒèƒ½ã€‚
                    </p>
                  </div>
                  <div class="concept-item">
                    <h5>åˆ©ç‡</h5>
                    <p>
                      åˆ©ç‡æ˜¯è´§å¸èµ„é‡‘çš„ä»·æ ¼ï¼Œè¡¨ç¤ºåœ¨ä¸€å®šæ—¶æœŸå†…åˆ©æ¯ä¸æœ¬é‡‘çš„æ¯”ç‡ã€‚
                    </p>
                  </div>
                  <div class="concept-item">
                    <h5>é€šè´§è†¨èƒ€</h5>
                    <p>
                      é€šè´§è†¨èƒ€æ˜¯æŒ‡ç‰©ä»·æ™®éæŒç»­ä¸Šæ¶¨ï¼Œè´§å¸è´­ä¹°åŠ›ä¸‹é™çš„ç»æµç°è±¡ã€‚
                    </p>
                  </div>
                </div>
              </div>

              <div class="practice-section">
                <h4>ğŸ’¡ ç»ƒä¹ é¢˜</h4>
                <el-card class="quiz-card">
                  <p><strong>é—®é¢˜ï¼š</strong>ä»¥ä¸‹å“ªä¸€é¡¹ä¸å±äºè´§å¸çš„åŸºæœ¬èŒèƒ½ï¼Ÿ</p>
                  <el-radio-group v-model="quiz1" class="quiz-options">
                    <el-radio label="A">ä»·å€¼å°ºåº¦</el-radio>
                    <el-radio label="B">æµé€šæ‰‹æ®µ</el-radio>
                    <el-radio label="C">æŠ•èµ„å·¥å…·</el-radio>
                    <el-radio label="D">è´®è—æ‰‹æ®µ</el-radio>
                  </el-radio-group>
                  <div class="quiz-result" v-if="quiz1">
                    <el-alert
                      :type="quiz1 === 'C' ? 'success' : 'error'"
                      :title="
                        quiz1 === 'C'
                          ? 'å›ç­”æ­£ç¡®ï¼'
                          : 'å›ç­”é”™è¯¯ï¼Œæ­£ç¡®ç­”æ¡ˆæ˜¯Cé€‰é¡¹'
                      "
                      show-icon
                    />
                  </div>
                </el-card>
              </div>
            </div>
          </el-card>

          <!-- 1.2 é‡‘èæœºæ„ä½“ç³» -->
          <el-card class="content-card" id="section-1-2">
            <template #header>
              <div class="card-header">
                <span class="section-title">1.2 é‡‘èæœºæ„ä½“ç³»</span>
                <el-tag size="small" type="warning">è¿›è¡Œä¸­</el-tag>
              </div>
            </template>
            <div class="section-content">
              <div class="learning-objectives">
                <h4>ğŸ¯ å­¦ä¹ ç›®æ ‡</h4>
                <ul>
                  <li>äº†è§£å„ç±»é‡‘èæœºæ„çš„èŒèƒ½å’Œä½œç”¨</li>
                  <li>æŒæ¡é‡‘èæœºæ„çš„ç»„ç»‡å½¢å¼</li>
                  <li>ç†è§£é‡‘èæœºæ„ä¹‹é—´çš„å…³ç³»</li>
                </ul>
              </div>

              <div class="institution-types">
                <h4>ğŸ¦ ä¸»è¦é‡‘èæœºæ„ç±»å‹</h4>
                <div class="institution-grid">
                  <div class="institution-card">
                    <div class="institution-icon">ğŸ¦</div>
                    <h5>å•†ä¸šé“¶è¡Œ</h5>
                    <p>ä»¥ç›ˆåˆ©ä¸ºç›®çš„ï¼Œç»è¥å­˜æ¬¾ã€è´·æ¬¾ã€ç»“ç®—ç­‰ä¸šåŠ¡çš„é‡‘èæœºæ„</p>
                  </div>
                  <div class="institution-card">
                    <div class="institution-icon">ğŸ›ï¸</div>
                    <h5>ä¸­å¤®é“¶è¡Œ</h5>
                    <p>å›½å®¶çš„é“¶è¡Œï¼Œè´Ÿè´£åˆ¶å®šå’Œæ‰§è¡Œè´§å¸æ”¿ç­–ï¼Œç»´æŠ¤é‡‘èç¨³å®š</p>
                  </div>
                  <div class="institution-card">
                    <div class="institution-icon">ğŸ“ˆ</div>
                    <h5>æŠ•èµ„é“¶è¡Œ</h5>
                    <p>ä¸“é—¨ä»äº‹è¯åˆ¸å‘è¡Œã€äº¤æ˜“ã€æŠ•èµ„å’¨è¯¢ç­‰ä¸šåŠ¡çš„é‡‘èæœºæ„</p>
                  </div>
                </div>
              </div>
            </div>
          </el-card>

          <!-- æ›´å¤šç« èŠ‚é¢„è§ˆ -->
          <el-card class="preview-card">
            <div class="preview-content">
              <h4>ğŸ“‹ åç»­ç« èŠ‚é¢„è§ˆ</h4>
              <div class="preview-items">
                <div class="preview-item">
                  <span class="preview-number">1.3</span>
                  <span class="preview-title">é‡‘èå¸‚åœº</span>
                  <el-tag size="mini" type="info">æœªå¼€å§‹</el-tag>
                </div>
                <div class="preview-item">
                  <span class="preview-number">1.4</span>
                  <span class="preview-title">è´¢åŠ¡æŠ¥è¡¨åˆ†æ</span>
                  <el-tag size="mini" type="info">æœªå¼€å§‹</el-tag>
                </div>
                <div class="preview-item">
                  <span class="preview-number">1.5</span>
                  <span class="preview-title">åŸºæœ¬è´¢åŠ¡æŒ‡æ ‡</span>
                  <el-tag size="mini" type="info">æœªå¼€å§‹</el-tag>
                </div>
                <div class="preview-item">
                  <span class="preview-number">1.6</span>
                  <span class="preview-title">çŸ¥è¯†æµ‹è¯•</span>
                  <el-tag size="mini" type="info">æœªå¼€å§‹</el-tag>
                </div>
              </div>
            </div>
          </el-card>
        </div>

        <!-- åº•éƒ¨å¯¼èˆª -->
        <div class="bottom-nav">
          <div class="nav-buttons">
            <el-button 
              type="success" 
              size="large" 
              @click="completeStudy"
            >
              âœ“ å®Œæˆæœ¬ç« å­¦ä¹ 
            </el-button>
            <el-button 
              type="primary" 
              size="large" 
              @click="nextChapter"
            >
              ä¸‹ä¸€ç« ï¼šé‡‘èäº§å“ä¸æœåŠ¡
              <el-icon><ArrowRight /></el-icon>
            </el-button>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import { ref, onMounted } from "vue";
import { useRouter } from "vue-router";
import { ElMessage, ElMessageBox } from "element-plus";
import { ArrowLeft, ArrowRight } from "@element-plus/icons-vue";

export default {
  name: "TeachingProcessOne",
  components: {
    ArrowLeft,
    ArrowRight,
  },
  setup() {
    const router = useRouter();
    const quiz1 = ref("");
    const isCompleted = ref(false);

    // æ£€æŸ¥æ˜¯å¦å·²ç»å®Œæˆè¿‡
    onMounted(() => {
      const progress = JSON.parse(localStorage.getItem('teachingProgress') || '{}');
      if (progress.stepTasks && progress.stepTasks['step0']?.completed) {
        isCompleted.value = true;
      }
    });

    // å®Œæˆæœ¬ç« å­¦ä¹ 
    const completeStudy = () => {
      ElMessageBox.confirm(
        'ç¡®è®¤å·²å®Œæˆæœ¬ç« æ‰€æœ‰å†…å®¹çš„å­¦ä¹ å—ï¼Ÿ',
        'å®Œæˆå­¦ä¹ ',
        {
          confirmButtonText: 'ç¡®è®¤å®Œæˆ',
          cancelButtonText: 'ç»§ç»­å­¦ä¹ ',
          type: 'success'
        }
      ).then(() => {
        // ä» localStorage è·å–å½“å‰è¿›åº¦
        let progress = JSON.parse(localStorage.getItem('teachingProgress') || '{}');
        
        // æ›´æ–°è¿›åº¦æ•°æ®
        progress.completedSteps = Math.max(progress.completedSteps || 0, 1); // å®Œæˆç¬¬ä¸€æ­¥
        progress.currentStep = Math.max(progress.currentStep || 0, 1); // å½“å‰åœ¨ç¬¬äºŒæ­¥
        
        // æ ‡è®°ç¬¬ä¸€æ­¥çš„æ‰€æœ‰ä»»åŠ¡ä¸ºå·²å®Œæˆ
        if (!progress.stepTasks) {
          progress.stepTasks = {};
        }
        progress.stepTasks['step0'] = {
          completed: true,
          completedCount: 8, // ç¬¬ä¸€æ­¥æœ‰8ä¸ªä»»åŠ¡
          totalCount: 8
        };

        // ä¿å­˜åˆ° localStorage
        localStorage.setItem('teachingProgress', JSON.stringify(progress));
        
        isCompleted.value = true;
        
        ElMessage.success({
          message: 'æ­å–œå®Œæˆç¬¬ä¸€ç« å­¦ä¹ ï¼è¿›åº¦å·²ä¿å­˜',
          duration: 2000
        });
        
        // 2ç§’åè¿”å›æ•™å­¦è¿‡ç¨‹é¡µé¢
        setTimeout(() => {
          router.push("/teaching-process");
        }, 2000);
      }).catch(() => {
        ElMessage.info('ç»§ç»­å­¦ä¹ ä¸­...');
      });
    };

    // ç›´æ¥è¿›å…¥ä¸‹ä¸€ç« ï¼ˆä¸æ ‡è®°å®Œæˆï¼‰
    const nextChapter = () => {
      router.push("/teaching-process/two");
    };

    return {
      quiz1,
      isCompleted,
      completeStudy,
      nextChapter,
    };
  },
};
</script>

<style scoped>
.detail-page {
  width: 100%;
  min-height: 100vh;
  background: #f0f2f5;
}

.nav-bar {
  background: #fff;
  border-bottom: 1px solid #e4e7ed;
  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
  /* position: sticky; */
  top: 0;
  z-index: 1000;
  width: 100%;
}

.nav-container {
  width: 100%;
  padding: 0 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  height: 60px;
}

.nav-center h2 {
  margin: 0;
  color: #303133;
  font-size: 18px;
  font-weight: 600;
}

.progress-text {
  color: #909399;
  font-size: 14px;
}

.content-wrapper {
  width: 100%;
  padding: 20px;
}

.content-container {
  width: 100%;
  padding: 0;
}

.chapter-nav {
  margin-bottom: 20px;
}

.chapter-card {
  border-radius: 8px;
}

.chapter-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.chapter-header h3 {
  margin: 0;
  color: #303133;
}

.chapter-progress {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-top: 10px;
}

.chapter-progress .progress-text {
  font-size: 12px;
  color: #909399;
}

.detail-content {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.content-card {
  border-radius: 8px;
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.section-title {
  font-weight: 600;
  color: #303133;
}

.section-content {
  padding: 10px 0;
}
.learning-objectives {
  margin-bottom: 15px;
}
.key-concepts {
  margin-bottom: 15px;
}

.learning-objectives h4,
.key-concepts h4,
.practice-section h4,
.institution-types h4 {
  color: #303133;
  margin-bottom: 15px;
  font-size: 16px;
}

.learning-objectives ul {
  padding-left: 20px;
}

.learning-objectives li {
  margin-bottom: 8px;
  color: #606266;
}

.concept-grid,
.institution-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 15px;
  margin-top: 15px;
}

.concept-item,
.institution-card {
  padding: 15px;
  border: 1px solid #e4e7ed;
  border-radius: 6px;
  background: #fafafa;
}

.concept-item h5,
.institution-card h5 {
  margin: 0 0 8px 0;
  color: #303133;
  font-size: 14px;
}

.concept-item p,
.institution-card p {
  margin: 0;
  color: #606266;
  font-size: 13px;
  line-height: 1.5;
}

.institution-icon {
  font-size: 24px;
  margin-bottom: 10px;
}

.quiz-card {
  margin-top: 15px;
}

.quiz-options {
  /* margin: 15px 0; */
  margin-top: 15px;
  /* margin-bottom: 5px; */
}

.quiz-options .el-radio {
  display: block;
  margin-bottom: 10px;
}

/* .quiz-result {
  margin-top: 15px;
} */

.preview-card {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
}

.preview-content h4 {
  margin: 0 0 15px 0;
  color: white;
}

.preview-items {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.preview-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 6px;
  backdrop-filter: blur(10px);
}

.preview-number {
  background: rgba(255, 255, 255, 0.2);
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 600;
  min-width: 35px;
  text-align: center;
}

.preview-title {
  flex: 1;
  font-size: 14px;
}

.bottom-nav {
  margin-top: 30px;
  padding: 20px 0;
  border-top: 1px solid #e4e7ed;
}

.nav-buttons {
  display: flex;
  justify-content: flex-end;
  /* gap: 15px; */
  flex-wrap: wrap;
}

@media (max-width: 768px) {
  .nav-container {
    padding: 0 15px;
  }

  .content-container {
    padding: 0 15px;
  }

  .concept-grid,
  .institution-grid {
    grid-template-columns: 1fr;
  }

  .nav-center h2 {
    font-size: 16px;
  }
}
</style>
